<%@ page import="simulator.*" %>
<%
  User user = (User)session.getAttribute("user");
  User[] users = Users.getUsers();
  if(user == null) { %>
<html>
  <body>
    <script>
      window.location.replace(location.origin + "/StockMarketSimulator/timeout");
    </script>
  </body>
</html>
<% } else if (users == null) { %>
<html>
  <body>
    <script>
      window.location.replace(location.origin + "/StockMarketSimulator/error");
    </script>
  </body>
</html>
<%  } else { %>
<html>
  <head>
    <title>LeaderBoard</title>
    <style>
      li {
      margin: 10px 0;
      }
    </style>
  </head>

  <body>
    <button OnClick='sendToDashboard()'>Dashboard</button>
    <h2>Leaderboard</h2>
    <button OnClick='sortByAmountOfMoney()'>Money</button>
    <button OnClick='sortByAverageStockPrice()'>Stocks</button>
    <br>
    <br>
    
    <table>
      <tr>
	<th id=titleColumn1></th>
        <th id=titleColumn2></th>
        <th id=titleColumn3></th>
        <th id=titleColumn4></th>
        <th id=titleColumn5></th>
      </tr>
      <% for(User u : users) {
	 String uname = u.getName();
      %>
      <tr>
        <td id=<% out.print("\"" + uname + "column1\""); %> >
	</td>
	<td id=<% out.print("\"" + uname + "column2\""); %> >
	</td>
	<td id=<% out.print("\"" + uname + "column3\""); %> >
	</td>
	<td id=<% out.print("\"" + uname + "column4\""); %> >
	</td>
	<td id=<% out.print("\"" + uname + "column5\""); %> >
	</td>
      </tr>
      <% } %>
</table>
    <script>
      function sendToDashboard() {
        var url = location.origin + "/StockMarketSimulator/dashboard";
        window.location.replace(url);
      }

      function sortByAmountOfMoney() {
        var url = location.origin + "/StockMarketSimulator/leaderboard?sort=money";
        xmlHttp.open("GET", url, false); // false for a synchronous request
        xmlHttp.send(null);
        var response =JSON.parse(xmlHttp.responseText);
        var status = response.status;
        if(status == "success") {
          update();
        } else {
          alert(status);
          location.reload();
        }
      }

      function sortByAmountOfMoney() {
        var url = location.origin + "/StockMarketSimulator/leaderboard?sort=stocks";
        xmlHttp.open("GET", url, false); // false for asynchronous request
      xmlHttp.send(null);
        var response =JSON.parse(xmlHttp.responseText);
        var status = response.status;
        if(status == "success"){
          update();
        } else {
          alert(status);
          location.reload();
        }
      } 

      function update() {
        var url = location.origin + "/StockMarketSimulator/leaderboardUpdate";
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", url, false ); // false for a synchronous request
        xmlHttp.send( null );
        var response = JSON.parse(xmlHttp.responseText
        if (response.timeout) {
          window.location.replace(location.origin + "/StockMarketSimulator/timeout");
        } else if(response.error) {
           alert("An error occured.");
           location.reload();
        } else {
          document.getElementById("titleColumn1").innerHTML = response.titleColumn1;
          document.getElementById("titleColumn2").innerHTML = response.titleColumn2;
          document.getElementById("titleColumn3").innerHTML = response.titleColumn3;
          document.getElementById("titleColumn4").innerHTML = response.titleColumn4;
          document.getElementById("titleColumn5").innerHTML = response.titleColumn5;
          var users = response.users;
          for (var user in users) {
            document.getElementById(user+"column1").innerHTML = users[user].column1;
            document.getElementById(user+"column1").innerHTML = users[user].column1;
            document.getElementById(user+"column1").innerHTML = users[user].column1;
            document.getElementById(user+"column1").innerHTML = users[user].column1;
            document.getElementById(user+"column1").innerHTML = users[user].column1;
          }
        }
      } 

      update();
      </script>
    </body>
</html>
<% } %>

